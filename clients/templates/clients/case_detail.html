{% extends 'clients/dashboard_base.html' %}

{% block title %}Case #{{ case.id }} - Lawgorithm{% endblock %}
{% block header_title %}{{ case.title }}{% endblock %}

{% block content %}
<style>
    .case-nav {
        display: flex;
        border-bottom: 2px solid var(--border-color);
        margin-bottom: 2rem;
        gap: 2rem;
    }

    .case-tab {
        padding: 1rem 0;
        color: var(--text-gray);
        text-decoration: none;
        font-weight: 600;
        position: relative;
        cursor: pointer;
        background: none;
        border: none;
        font-size: 1rem;
    }

    .case-tab.active {
        color: var(--primary-navy);
    }

    .case-tab.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 2px;
        background: var(--accent-gold);
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .detail-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
    }
</style>

<div class="case-nav">
    <button class="case-tab active" onclick="switchTab('details')">Case Details</button>
    <button class="case-tab" onclick="switchTab('matches')">Lawyer Matches ({{ interactions.count }})</button>
    <button class="case-tab" onclick="switchTab('documents')">Documents</button>
    <button class="case-tab" onclick="switchTab('messages')">Messages</button>
</div>

<!-- DETAILS TAB -->
<div id="details" class="tab-content active">
    <div class="detail-grid">
        <div class="card">
            <h3 style="margin-bottom: 1rem;">Description</h3>
            <p style="line-height: 1.6; color: var(--text-dark);">
                {{ case.description }}
            </p>
        </div>
        <div>
            <div class="card">
                <h4 style="margin-bottom: 1rem; font-size: 0.95rem; color: var(--text-gray);">CASE INFO</h4>
                <div style="margin-bottom: 1rem;">
                    <div style="font-size: 0.85rem; color: var(--text-gray);">Category</div>
                    <div style="font-weight: 600;">{{ case.category.name }}</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <div style="font-size: 0.85rem; color: var(--text-gray);">Court</div>
                    <div style="font-weight: 600;">{{ case.court_level.name|default:"Not specified" }}</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <div style="font-size: 0.85rem; color: var(--text-gray);">Fee Band</div>
                    <div style="font-weight: 600; color: var(--accent-gold);">{{ case.fee_band.label|default:"Flexible" }}</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <div style="font-size: 0.85rem; color: var(--text-gray);">Status</div>
                    <span class="badge badge-{{ case.status }}">{{ case.get_status_display }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MATCHES TAB -->
<div id="matches" class="tab-content">
    <div class="card">
        <h3>Responses from Lawyers</h3>
        <br>
        {% for interaction in interactions %}
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding: 1rem 0;">
            <div style="display: flex; gap: 1rem; align-items: center;">
                <div style="width: 50px; height: 50px; background: #e2e8f0; border-radius: 50%; overflow: hidden;">
                    {% if interaction.lawyer.profile_picture %}
                        <img src="{{ interaction.lawyer.profile_picture.url }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% endif %}
                </div>
                <div>
                    <h4 style="margin: 0;">{{ interaction.lawyer.user.first_name }} {{ interaction.lawyer.user.last_name }}</h4>
                    <p style="font-size: 0.9rem; color: var(--text-gray);">{{ interaction.lawyer.experience_years }} years exp â€¢ {{ interaction.lawyer.city.name }}</p>
                </div>
            </div>
            <div>
                <span class="badge badge-{{ interaction.status }}">{{ interaction.get_status_display }}</span>
                <button class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.9rem; margin-left: 1rem;">View Profile</button>
            </div>
        </div>
        {% empty %}
        <p style="color: var(--text-gray);">No lawyers have responded yet.</p>
        {% endfor %}
    </div>
</div>

<!-- DOCUMENTS TAB -->
<div id="documents" class="tab-content">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3>Case Documents</h3>
            <form method="POST" enctype="multipart/form-data" style="display: flex; gap: 0.5rem; align-items: center;">
                {% csrf_token %}
                <input type="file" name="document" required style="font-size: 0.9rem;">
                <button type="submit" class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Upload</button>
            </form>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
            {% for doc in documents %}
            <div style="border: 1px solid var(--border-color); padding: 1rem; border-radius: 8px;">
                <i class="fas fa-file-pdf" style="font-size: 2rem; color: #ef4444; margin-bottom: 0.5rem;"></i>
                <div style="font-weight: 500;">{{ doc.title|default:doc.file.name }}</div>
                <div style="font-size: 0.8rem; color: var(--text-gray);">{{ doc.uploaded_at|date:"M d, Y" }}</div>
                <a href="{{ doc.file.url }}" target="_blank" style="color: var(--primary-navy); font-size: 0.85rem; font-weight: 600; display: block; margin-top: 0.5rem;">Download</a>
            </div>
            {% empty %}
            <p>No documents uploaded.</p>
            {% endfor %}
        </div>
    </div>
</div>

<!-- MESSAGES TAB -->
<div id="messages" class="tab-content">
    <div class="card">
        <h3>Secure Messages</h3>
        <p style="color: var(--text-gray);">Communicate securely with your hired lawyer here.</p>
        <br>
        <div style="background: #f8fafc; padding: 2rem; text-align: center; border-radius: 8px; border: 1px dashed var(--border-color);">
            {% if case.status == 'hired' %}
                <!-- Real chat implementation would go here -->
                <p>Chat interface available upon hiring.</p>
            {% else %}
                <p>You can start messaging once you hire a lawyer for this case.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function switchTab(tabId) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.case-tab').forEach(btn => btn.classList.remove('active'));
        
        // Show selected
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
    }
</script>
{% endblock %}
